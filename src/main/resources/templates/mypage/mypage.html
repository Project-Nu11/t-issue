<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <style>
        body {
            margin:0;
            font-family: Aggravo;
        }
        .title{
            font-size: 48px;
            font-weight: bold;
            margin-left: 29px;
            margin-top: 29px;
        }
        /* 공통 원형 버튼 */
        .mp-circle{
            width:92px;
            height:92px;
            border-radius:50%;
            background:#fff;display:flex;
            flex-direction:column;
            gap:6px;
            align-items:center;
            justify-content:center;
            box-shadow:0 4px 16px rgba(0,0,0,.12);
            text-decoration:none;
            color:#111;
            font-size:14px;
            text-align:center;
            padding:10px;
        }
        .mp-circle img{width:70px;height:70px;display:block}

        /* 원형 배치 컨테이너 */
        .mp-radial{
            /* 주변 아이템 개수/반지름/좌우미세이동 */
            --count:5;        /* 주변 버튼 개수 */
            --r:180px;        /* 반지름 */
            --shift:-50px;    /* 링 전체를 왼(-)쪽/오(+)른쪽 이동 */
            position:relative;
            width:360px;height:360px;
            margin:28px auto 0;
        }

        /* 중앙(지하철 아이콘) */
        .mp-center{
            position:absolute;top:50%;left:50%;
            transform:translate(-50%,-50%);
        }

        /* 주변 아이템 */
        .mp-node{
            position:absolute;
            top:35%;left:40%;
            transform-origin:center;
            transform:
                    rotate(calc(var(--i) * 1turn / var(--count)))
                    translate(var(--r))
                    rotate(calc(-1 * var(--i) * 1turn / var(--count)))
                    translateX(var(--shift));   /* 원형 링 좌 우 이동 */
            will-change: transform;
        }
        /* 중앙 지하철 아이콘 */
        .mp-center-plain{
            background: transparent !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            width: auto; height: auto; padding: 0;
        }
        .mp-center-plain img{ width:70px; height:70px; display:block; }

        /*.logout-btn {*/
        /*    font-family: Aggravo;*/
        /*    font-size: 15px;*/
        /*    font-weight:normal;*/
        /*    margin-top: 200px;*/
        /*    margin-left: 250px;*/
        /*    width: 100px;*/
        /*    border-radius: 8px;*/
        /*    border:1px solid rgba(0,0,0,.2);*/
        /*}*/
        .deleteback{
            width:100%; height:100%;
            background:rgba(0,0,0,50%);
            z-index:1100;
            display:none;
            position:fixed;
            top:0; left:0;
            align-items:center;
            justify-content:center;
        }
        .viewdeleteback{
            width:100%; height:100%;
            background:rgba(0,0,0,50%);
            z-index:1100;
            display:flex;
            position:fixed;
            top:0;left:0;
            align-items:center;
            justify-content:center;
        }
        #deletemodal{
            width:25%;
            height:30%;
            background:#fff;
            position:fixed;
            top:35%; left:37.5%; z-index:1004;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            border-radius:8px;
            padding:20px;
            box-shadow:0 8px 20px rgba(0,0,0,.25);
        }
        #deletemodal p{
            font-size:16px;
            font-weight:700;
            margin-bottom:18px;
            text-align:center;
        }
        #deletemodal .btns{
            display:flex; gap:10px;
        }
        #deletemodal button{
            min-width:80px;
            height:32px;
            border:1px solid rgba(0,0,0,.25);
            border-radius:8px;
            background:#fff;
            cursor:pointer;
        }

        .logout-btn{
            font-family: 'AggravoM', 'Aggravo', system-ui, -apple-system, Arial, sans-serif;
            font-weight: 500;
            font-size: 15px;
            margin-top: 200px;
            margin-left: 250px;
            width: 100px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,.2);
        }

        #deletemodal p{
            font-family: 'Aggravo', system-ui, -apple-system, Arial, sans-serif;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 18px;
            text-align: center;
        }

        #deletemodal .btns{ display:flex; gap:10px; }

        #deletemodal button{
            font-family: 'AggravoM', 'Aggravo', system-ui, -apple-system, Arial, sans-serif !important;
            font-weight: 500;
            min-width: 80px;
            height: 36px;
            padding: 0 14px;
            border: 1px solid rgba(0,0,0,.25);
            border-radius: 8px;
            background: #fff;
            cursor: pointer;

            /* 수직/수평 중앙 정렬 */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;

        }

    </style>
</head>
<body>
<div th:include="/common/header.html"></div>
    <div id="main">
        <p class="title">마이페이지</p>
        <div class="content">

    <div class="grid">
        <!--개인정보 조회 -->
        <div class="mp-radial" style="--count:5; --r:160px; --shift:-24px;">

            <!-- 중앙: 지하철 아이콘 -->
            <a class="mp-center mp-center-plain" href="javascript:void(0)">
                <img src="icon/icons8-subway-50.png" alt="subway">
            </a>

            <!-- 주변 5개 (i = 0..4) -->
            <a class="mp-circle mp-node" style="--i:3" th:href="@{/mypage/select}">
                <img src="/icon/free-icon-user-747376.png" alt="">
                <span>개인정보<br>조회</span>
            </a>

            <a class="mp-circle mp-node" style="--i:4" th:href="@{/mypage/request}">
                <img src="/icon/icons8-why-quest-100.png" alt="">
                <span>문의</span>
            </a>

            <a class="mp-circle mp-node" style="--i:2" th:href="@{/mypage/review}">
                <img src="/icon/free-icon-review-4047898.png" alt="">
                <span>리뷰/조회</span>
            </a>

            <a class="mp-circle mp-node" style="--i:0" href="javascript:void(0)">
                <img src="/icon/free-icon-yellow-card-7458915.png" alt="">
                <span>벌점</span>
            </a>

            <a class="mp-circle mp-node" style="--i:1" href="javascript:void(0)">
                <img src="/icon/free-icon-global-591788.png">
                <span>언어설정</span>
            </a>
        </div>

    </div>

            <form id="logoutForm" th:action="@{/member/logout}" method="post" style="display:inline">
                <!-- CSRF 쓰면 ↓ 활성화
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                -->
                <button type="button" id="logoutBtn" class="btn logout-btn">로그아웃</button>
            </form>
</div>
</div>

<!-- 공통 모달 (확인/완료 두 상태를 이 한 개로 재사용) -->
<div class="deleteback" id="modalBack" aria-hidden="true">
    <div id="deletemodal" role="dialog" aria-modal="true" aria-labelledby="modalMsg">
        <p id="modalMsg">메시지</p>
        <div class="btns">
            <button id="modalOk">예</button>
            <button id="modalCancel">아니오</button>
        </div>
    </div>
</div>

<!-- 공통헤더/전역 스크립트임!! 없으면 콘솔 에러남...-->

<script>
    (function(){
        const logoutBtn   = document.getElementById('logoutBtn');
        const logoutForm  = document.getElementById('logoutForm');

        // 모달 요소
        const back   = document.getElementById('modalBack');
        const msgEl  = document.getElementById('modalMsg');
        const okBtn  = document.getElementById('modalOk');
        const noBtn  = document.getElementById('modalCancel');
        const btns   = document.querySelector('#deletemodal .btns');

        // 요소가 없는 페이지에서는 조용히 종료 (공용 스크립트일 때 안전)
        <!-- 공통헤더/전역 스크립트임!! 없으면 콘솔 에러남...-->
        if (!logoutBtn || !logoutForm || !back || !msgEl || !okBtn || !noBtn) return;

        // 모달 열기
        function openModal(message, mode, onOk){
            msgEl.textContent = message || '';
            back.className = 'deleteback viewdeleteback';
            back.setAttribute('aria-hidden','false');

            if (mode === 'confirm'){
                // 예/아니오
                noBtn.style.display = 'inline-flex';
                okBtn.textContent   = '예';
                okBtn.onclick = async function(){
                    await onOk?.(); // 예 눌렀을 때 콜백(로그아웃 실행)
                };
                noBtn.onclick = closeModal;
            } else {
                // alert(완료)
                noBtn.style.display = 'none';
                okBtn.textContent   = '확인';
                okBtn.onclick = function(){
                    closeModal();
                    onOk?.(); // 확인 후 이동
                };
            }
            // 배경 클릭으로 닫히게 하려면 주석 해제
            // back.onclick = (e)=>{ if(e.target===back) closeModal(); };
        }

        function closeModal(){
            back.className = 'deleteback';
            back.setAttribute('aria-hidden','true');
            okBtn.onclick = null;
            noBtn.onclick = null;
        }

        // 실제 로그아웃 실행 → 성공하면 완료 알럿 → 메인 이동
        async function doLogout(){
            // CSRF
            const csrfInput = logoutForm.querySelector('input[name="_csrf"]');
            const headers = {};
            if (csrfInput && csrfInput.value) headers['X-CSRF-TOKEN'] = csrfInput.value;

            try {
                const resp = await fetch(logoutForm.getAttribute('action') || logoutForm.action, {
                    method: 'POST',
                    headers,
                    credentials: 'same-origin'
                });

                if (resp.ok){
                    // 완료 알럿 → 확인 시 메인으로
                    openModal('로그아웃이 완료되었습니다.', 'alert', () => location.href = '/main');
                } else {
                    openModal('로그아웃 중 오류가 발생했습니다. 다시 시도해 주세요.', 'alert');
                }
            } catch (e){
                openModal('네트워크 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.', 'alert');
            }
        }

        // 로그아웃 버튼 클릭 → 확인 모달
        logoutBtn.addEventListener('click', function(){
            openModal('로그아웃 하시겠습니까?', 'confirm', doLogout);
        });
    })();
</script>

</body>
</html>
