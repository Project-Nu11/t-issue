<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .top-nav {
            display: flex;
            flex-direction: row;
        }
        .stationToilet {
            font-size: 36px;
            font-weight: bold;
            margin-left: 29px;
            margin-top: 29px;
        }
        #toiletExit {
            width: 400px;
            height: 300px;
            margin-top: 29px;
        }
        #details {
            margin-left: 29px;
            margin-right: 29px;
            margin-top: 5px;
        }
        .column {
            width: 100px ;
            height: 50px;
            text-align: center;
            /*border: 1px solid #000;*/
            font-weight: bold;
            font-size: 24px;
        }
        .context {
            width: 418px;
            height: 50px;
            text-align: center;
            /*border: 1px solid #000000;*/
            font-family: AggravoL;
            font-size: 16px;
        }
        #icons {
            margin-top: 10px;
            display: flex;
            gap: 55px;
            justify-content: center;
        }
        #icons button {
            width: 75px;
            height: 75px;
            border-radius: 50px;
            border: none;
        }
        /* modal은 모달창 뒤 어두운 배경 */
        .modal {
            display: none;
            position: fixed;
            z-index:1;
            left:0;
            top:0;
            width:100%;
            height:100%;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .detailModal {
            background-color: #fefefe;
            margin: 15% auto;
            padding : 15px;
            border: 1px solid #888;
            width: 400px;
            height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            /*z-index: 1004;*/
            /*position: relative;*/
        }
        .modalTitle {
            font-size: 28px;
        }
        .modalContent {
            width: 350px;
            height: 250px;
            /*border: 1px solid gray;*/
            border-radius: 7px;
            box-shadow: inset 2px 2px 5.8px rgba(0,0,0,0.25);
            margin-bottom: 20px;
            padding: 15px;
        }
        li {
            list-style: none;
            padding: 15px;
            font-family: AggravoM;
        }
        /*#review {*/
        /*    margin-left: 29px;*/
        /*}*/
        #reviewNav {
            margin-top: 20px;
            display: flex;
        }
        /*#reviewContext {*/
        /*    margin-top: 20px;*/
        /*}*/
        #review button {
            border: none;
            background: none;
        }
        #reviewModal #insertReview {
            background-color: #fefefe;
            margin: 15% auto;
            padding : 15px;
            border: 1px solid #888;
            width: 400px;
            height: 320px;
            align-items: center;
            border-radius: 8px;
        }
        .review {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        .content, .score {
            font-family: AggravoL;
        }
        .memberId, .date {
            font-family: AggravoM;
        }
    </style>
</head>
<body>
<div th:include="/common/header.html"></div>
<div id="main">
    <section class="top-nav">
        <div class="stationToilet" th:text="|${stationName}역 ${toilet.ground} ${toilet.floor}층 ${toilet.gateInOut} 화장실|">화장실 이름</div>
        <!--        th:text="${stationName} + '역 ' + ${toilet.ground} + ' ' + ${toilet.floor} + '층 ' + ${toilet.gateInOut} + ' 화장실'"-->
    </section>
    <!-- 사진은 마지막에 어떻게 해야할 지.. -->
    <div style="text-align: center"><img id="toiletExit" src="/image/512-1.png" alt="입구 사진"></div>
    <section>
        <table id="details">
            <tr>
                <th class="column">주소</th>
                <th class="context" th:text="${toilet.address}"></th>
            </tr>
            <tr>
                <th class="column">위치</th>
                <th class="context" th:text="${toilet.toiletLocation}"></th>
            </tr>
            <tr>
                <th class="column">개방시간</th>
                <th class="context">05:00 ~ 24:00</th>
            </tr>
        </table>

        <div id="icons"> <!--아이콘 클릭 시 변기 수 등의 정보가 담긴 모달창-->
            <button id="openManModal">
                <img src="/icon/toilet.png" alt="남자화장실아이콘" width="40" height="40">
            </button>
            <button id="openWomanModal">
                <img src="/icon/women.png" alt="여자화장실아이콘" width="40" height="40">
            </button>
            <button id="openDisabledModal">
                <img src="/icon/diffable.png" alt="장애인화장실아이콘" width="40" height="40">
            </button>
            <button id="openDiaperModal">
                <img src="/icon/baby.png" alt="기저귀교환대아이콘" width="40" height="40">
            </button>

            <div id="manModal" class="modal">
                <div class="detailModal">
                    <p class="modalTitle">남자화장실</p>
                    <div class="modalContent">
                        <li>대변기 수 : <span th:text="${toilet.menToilet}">0</span></li>
                        <li>소변기 수 : <span th:text="${toilet.menUrinal}">0</span></li>
                        <li>어린이용 대변기 수 : <span th:text="${toilet.boyToilet}">0</span></li>
                        <li>어린이용 소변기 수 : <span th:text="${toilet.boyUrinal}">0</span></li>
                    </div>
                </div>
            </div>
            <!-- 여자 화장실 모달 -->
            <div id="womanModal" class="modal">
                <div class="detailModal">
                    <p class="modalTitle">여자화장실</p>
                    <div class="modalContent">
                        <li>대변기 수 : <span th:text="${toilet.womenToilet}">0</span></li>
                        <li>어린이용 대변기 수 : <span th:text="${toilet.girlToilet}">0</span></li>
                    </div>
                </div>
            </div>
            <!-- 장애인 화장실 모달 -->
            <div id="disabledModal" class="modal">
                <div class="detailModal">
                    <p class="modalTitle">장애인화장실</p>
                    <div class="modalContent">
                        <li>남성 장애인용 대변기 수 : <span th:text="${toilet.disabledMenToilet}">0</span></li>
                        <li>남성 장애인용 소변기 수 : <span th:text="${toilet.disabledMenUrinal}">0</span></li>
                        <li>여성 장애인용 대변기 수 : <span th:text="${toilet.disabledWomenToilet}">0</span></li>
                    </div>
                </div>
            </div>
            <!-- 기저귀 교환대 모달 -->
            <div id="diaperModal" class="modal">
                <div class="detailModal">
                    <p class="modalTitle">기저귀 교환대</p>
                    <div class="modalContent">
                        <li>여자 화장실 : <span th:text="${toilet.diaperDeckYnWt}">N</span></li>
                        <li>여자 장애인 화장실 : <span th:text="${toilet.diaperDeckYnDwt}">N</span></li>
                        <li>남자 화장실 : <span th:text="${toilet.diaperDeckYnMt}">N</span></li>
                        <li>남자 장애인 화장실 : <span th:text="${toilet.diaperDeckYnDmt}">N</span></li>
                    </div>
                </div>
            </div>
        </div>

        <section style="margin-left: 29px">
            <div id="reviewNav">
                <div style="font-size: 24px;margin-left: 30px">리뷰</div>
                <button id = "openReview" type="button" style="background: none;border: none" >
                    <img src="/icon/pen.png" alt="작성" width="25" height="25">
                </button>

            </div>
            <div id="reviews" style="margin-top: 20px;margin-left: 25px">
                <div class="review" th:each="review : ${reviewList}"
                     th:attr="data-no=${review.no},
                  data-station=${review.stationName},
                  data-toilet=${review.toiletLocation}">
<!--                    <div class="no" th:text="${review.no}"></div>-->
<!--                    <div class="stationName" th:text="${review.stationName}"></div>-->
<!--                    <div class="toiletLocation" th:text="${review.toiletLocation}"></div>-->
                    <div class="memberId" style="font-size:18px;margin-bottom: 5px " th:text="${review.memberId}"></div>
                    <div>
                        <div class="score"  style="font-size: 16px" th:text="${review.score}"></div>
                    </div>
                    <div class="content" style="font-size: 16px;" th:text="${review.content}"></div>
                    <div class="date" style="font-size: 12px;margin-left: 300px" th:text="${review.date}"></div>
                </div>
            </div>

        </section>
        <!--리뷰 작성 모달-->
        <div id="reviewModal" class="modal">
            <div id="insertReview">
                <form action="/toilet/details" method="post">
                    <div><input type="hidden" name="memberId" th:value="${member?.memberId}" readonly></div>
                    <div><input type="hidden" name="stationName" th:value="${stationName}"></div>
                    <div><input type="hidden" name="toiletLocation" th:value="${toilet.toiletLocation}"></div>
                    <div><label for="ititle">별점</label></div>
                    <div><input type="text" placeholder="점수를 입력하세요" id="ititle" name="score"></div>
                    <br>
                    <div><label for="icontent">내용</label></div>
                    <div><textarea style="width: 320px;height: 180px" name="content" id="icontent" placeholder="내용을 입력하세요(최대 300자)" maxlength="300"></textarea></div>
                    <div class="contentlen"><span class="contentlength">0</span>/300</div>
                    <div class="btns">
                        <button class="registbtn" type="submit">작성</button>
                        <button class="cancelbtn" type="button">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</div>
<script th:inline="javascript">
    function openModal(id) {
        document.getElementById(id).style.display = "block";
    }

    function closeModal(event, id) {
        if (event.target === document.getElementById(id)) {
            document.getElementById(id).style.display = "none";
        }
    }

    document.getElementById("openManModal").onclick = () => openModal("manModal");
    document.getElementById("openWomanModal").onclick = () => openModal("womanModal");
    document.getElementById("openDisabledModal").onclick = () => openModal("disabledModal");
    document.getElementById("openDiaperModal").onclick = () => openModal("diaperModal");

    document.addEventListener("DOMContentLoaded", () => {
        let isLoggedIn = /*[[${isLoggedIn}]]*/ false;

        const openReviewBtn = document.getElementById("openReview");

        if (isLoggedIn) {
            openReviewBtn.disabled = false;
        }

        openReviewBtn.addEventListener('click', () => {
            if (isLoggedIn) {
                openModal("reviewModal");
            } else {
                alert('로그인이 필요합니다.');
                window.location.href='/member/login';
            }
        });

        const cancelBtn = document.querySelector(".cancelbtn");

        cancelBtn.addEventListener('click', () => {
            document.getElementById("reviewModal").style.display = "none";
        });

        window.onclick = (event) => {
            ["manModal", "womanModal", "disabledModal", "diaperModal", "reviewModal"].forEach(id => closeModal(event, id));
        };

    });
</script>
</body>
</html>