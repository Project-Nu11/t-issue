<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>로그인</title>
  <style>
    @font-face {
      font-family: 'SBAggroB';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SBAggroB.woff') format('woff');
      font-style: normal;
      font-display: swap;
    }
    html,body{
      font-family: 'SBAggroB';
    }

    label {
      display: block;
      margin: 30px 20px 10px;

      font-weight: 500;
      font-size: 20px;
      color: #000;
    }

    input[type="text"],
    input[type="password"] {
      font-family: 'Aggravo';
      font-weight: 300;
      width: 300px;
      height: 38px;
      margin-left: 20px;
      padding: 10px 12px;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 8px;
      background: #fff;
    }

    .title {
      margin: 25px 20px 10px;
      font-family: 'Aggravo';
      font-size: 25px;
      font-weight: 700;
    }

    /* 하단 버튼 3개 */
    .btn-row {
      display: flex;
      gap: 12px;
      margin: 200px 30px 100px;
      font-family: 'SBAggroB',serif;
    }

    .btn-row button {
      flex: 1;
      height: 32px;
      padding: 0 10px;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }

    /* 로그인 버튼 */
    .login-btn {
      width: 100px;
      height: 30px;
      margin-left: 420px;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 8px;
      background: #fff;
      color: #000;
      font-size: 14px;
      font-weight: 300;
      cursor: pointer;
    }
    .deleteback {
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,50%);
      z-index: 1100;
      display: none;
      position: fixed;
      top: 0;
      left: 0;
    }
    .viewdeleteback {
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,50%);
      z-index: 1100;
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      align-items: center;
      justify-content: center;
    }
    #deletemodal {
      width: 25%;
      height: 30%;
      background: white;
      position: fixed;
      top: 35%;
      left: 37.5%;
      z-index: 1004;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }
    #deletemodal p {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
    }
    #deletemodal button {
      min-width: 80px;
      height: 32px;
      border: 1px solid rgba(0,0,0,.25);
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- 공통 헤더 -->
<div th:include="/common/header.html"></div>

<div id="main">
  <p class="title">로그인</p>

  <form action="/member/login" method="post">
    <!-- 아이디 -->
    <label for="memberId">아이디</label>
    <input type="text" name="memberId" id="memberId"
           pattern="^(?=.{4,20}$)(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$"
           title="아이디는 영문과 숫자를 모두 포함한 4~20자여야 합니다."
           required autocomplete="username" autocapitalize="none"
           oninput="this.value=this.value.replace(/[^A-Za-z0-9]/g,'');" autofocus />

    <!-- 비밀번호 -->
    <label for="memberPwd">비밀번호</label>
    <input type="password" name="memberPwd" id="memberPwd"
           pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$"
           title="비밀번호는 영문과 숫자를 포함한 8자 이상이어야 합니다."
           required autocomplete="current-password" />

    <!-- 하단 버튼 -->
    <div class="btn-row">
      <button type="button" onclick="location.href='/member/find#id'">아이디 찾기</button>
      <button type="button" onclick="location.href='/member/find#pwd'">비밀번호 찾기</button>
      <button type="button" onclick="location.href='/member/register/consent'">회원가입</button>
    </div>

    <!-- 로그인 버튼 -->
    <button type="submit" class="login-btn">로그인</button>
  </form>
</div>

<div class="deleteback" id="loginModalBack">
  <div id="deletemodal">
    <p id="loginModalMsg">로그인되었습니다!</p>
    <button id="loginOkBtn">확인</button>
  </div>
</div>
<script>
  // 기존 포커스 유지
  document.getElementById('memberId')?.focus();

  (function () {
    const back   = document.getElementById('loginModalBack');  // .deleteback / .viewdeleteback
    const okBtn  = document.getElementById('loginOkBtn');
    const msgEl  = document.getElementById('loginModalMsg');


    function openModal(message) {
      if (message) msgEl.textContent = message;
      back.className = 'viewdeleteback';       // ← 보이기
    }
    function closeModal() {
      back.className = 'deleteback';           // ← 숨기기
    }

    // 확인 버튼 → 닫고 메인으로
    okBtn.addEventListener('click', function () {
      closeModal();
      location.href = '/main';
    });

    try {
      const url = new URL(window.location.href);
      if (url.searchParams.get('success') !== null) {
        openModal('로그인되었습니다!');
      }

      if (url.searchParams.get('code') === 'LOGIN_FAIL') {

        okBtn.onclick = function () { closeModal(); };
        openModal('아이디 또는 비밀번호가 올바르지 않습니다.');
      }
    } catch (_) {}
  })();
</script>
</body>
</html>
